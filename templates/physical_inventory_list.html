{% extends "base.html" %}

{% block title %}Physical Inventory{% endblock %}
{% block page_title %}Physical Inventory{% endblock %}

{% block header_actions %}
<a href="{{ url_for('new_physical_inventory') }}" class="btn btn-primary btn-sm">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
    Start New Inventory
</a>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">Physical Inventory Records</h3>
    </div>
    <div class="card-body">
        {% if inventories %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Items</th>
                        <th>Counted</th>
                        <th>Discrepancies</th>
                        <th>Status</th>
                        <th>Started By</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for inv in inventories %}
                    <tr>
                        <td class="font-mono">{{ inv.inventory_date.strftime('%m/%d/%Y') }}</td>
                        <td>
                            {% if inv.inventory_type == 'daily' %}
                            <span class="status-badge status-success">Daily</span>
                            {% elif inv.inventory_type == 'full' %}
                            <span class="status-badge status-info">Full</span>
                            {% elif inv.inventory_type == 'schedule2' %}
                            <span class="status-badge status-warning">Schedule II</span>
                            {% else %}
                            <span class="status-badge">Spot Check</span>
                            {% endif %}
                        </td>
                        <td class="font-mono">{{ inv.total_items }}</td>
                        <td class="font-mono">{{ inv.counted_items }} / {{ inv.total_items }}</td>
                        <td class="font-mono {% if inv.discrepancy_count > 0 %}text-danger{% endif %}">
                            {{ inv.discrepancy_count }}
                        </td>
                        <td>
                            {% if inv.status == 'in_progress' %}
                            <span class="status-badge status-warning">In Progress</span>
                            {% elif inv.status == 'completed' %}
                            <span class="status-badge status-success">Completed</span>
                            {% elif inv.status == 'reviewed' %}
                            <span class="status-badge status-info">Reviewed</span>
                            {% endif %}
                        </td>
                        <td>{{ inv.starter.full_name if inv.starter else '-' }}</td>
                        <td>
                            <div class="btn-group">
                                {% if inv.status == 'in_progress' %}
                                <a href="{{ url_for('perform_physical_inventory', id=inv.id) }}" class="btn btn-primary btn-sm">Continue</a>
                                {% else %}
                                <a href="{{ url_for('physical_inventory_report', id=inv.id) }}" class="btn btn-outline btn-sm">Report</a>
                                {% endif %}
                                {% if current_user.role == 'admin' %}
                                <form method="POST" action="{{ url_for('delete_physical_inventory', id=inv.id) }}" style="display: inline;"
                                      onsubmit="return confirm('Are you sure you want to delete this inventory count? This cannot be undone.');">
                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="48" height="48">
                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                <path d="M9 12l2 2 4-4"/>
            </svg>
            <h3>No Physical Inventories</h3>
            <p>Physical inventory counts help reconcile system quantities with actual on-hand amounts.</p>
            <a href="{{ url_for('new_physical_inventory') }}" class="btn btn-primary">Start New Inventory</a>
        </div>
        {% endif %}
    </div>
</div>

<div class="alert alert-info mt-3">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/>
        <line x1="12" y1="8" x2="12.01" y2="8"/>
    </svg>
    <div>
        <strong>Physical Inventory Types:</strong>
        <ul class="mb-0 mt-1">
            <li><strong>Daily:</strong> Quick daily verification count of all controlled substances</li>
            <li><strong>Full:</strong> Complete count of all controlled substances in inventory</li>
            <li><strong>Schedule II:</strong> Count only Schedule II substances</li>
            <li><strong>Spot Check:</strong> Random verification of selected items</li>
        </ul>
    </div>
</div>
{% endblock %}
