{% extends "base.html" %}

{% block title %}Reorder Alerts{% endblock %}
{% block page_title %}Reorder Alerts{% endblock %}

{% block header_actions %}
<a href="{{ url_for('reorder_settings') }}" class="btn btn-outline btn-sm">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
        <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </svg>
    Configure Reorder Points
</a>
{% endblock %}

{% block content %}
{% if needs_reorder %}
<div class="alert alert-warning mb-3">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
        <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
    </svg>
    <div>
        <strong>{{ needs_reorder|length }} medication(s) need to be reordered</strong>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Items Below Reorder Point</h3>
    </div>
    <div class="card-body">
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Medication</th>
                        <th class="text-right">Current Qty</th>
                        <th class="text-right">Reorder Point</th>
                        <th class="text-right">Suggested Order</th>
                        <th>Urgency</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in needs_reorder %}
                    <tr>
                        <td>
                            <span class="schedule-badge schedule-{{ item.medication.schedule|lower }}">
                                {{ item.medication.schedule }}
                            </span>
                            <strong>{{ item.medication.name }}</strong>{% if item.medication.strength %} <span class="text-muted">({{ item.medication.strength }})</span>{% endif %}
                        </td>
                        <td class="text-right font-mono text-danger font-bold">{{ item.current_qty }}</td>
                        <td class="text-right font-mono">{{ item.reorder_point }}</td>
                        <td class="text-right font-mono">{{ item.suggested_qty }}</td>
                        <td>
                            {% if item.current_qty == 0 %}
                            <span class="status-badge status-danger">OUT OF STOCK</span>
                            {% elif item.current_qty <= item.reorder_point / 2 %}
                            <span class="status-badge status-danger">Critical</span>
                            {% else %}
                            <span class="status-badge status-warning">Low</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.medication.schedule == 'II' %}
                            <a href="{{ url_for('add_form222') }}" class="btn btn-primary btn-sm">Create Form 222</a>
                            {% else %}
                            <a href="{{ url_for('receive_inventory') }}?medication_id={{ item.medication.id }}" class="btn btn-primary btn-sm">Receive</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-body">
        <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="48" height="48" style="color: var(--success);">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
            <h3>All Stock Levels OK</h3>
            <p>No medications are currently below their reorder point.</p>
            <a href="{{ url_for('reorder_settings') }}" class="btn btn-outline">Configure Reorder Points</a>
        </div>
    </div>
</div>
{% endif %}

<div class="alert alert-info mt-3">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
        <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/>
        <line x1="12" y1="8" x2="12.01" y2="8"/>
    </svg>
    <div>
        <strong>Tip:</strong> Configure reorder points in the settings to receive alerts when inventory gets low. 
        Schedule II substances require DEA Form 222 for ordering.
    </div>
</div>
{% endblock %}
